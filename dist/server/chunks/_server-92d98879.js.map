{"version":3,"file":"_server-92d98879.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/_site_/_page_/_server.js"],"sourcesContent":["import { e as error } from \"../../../../../chunks/index.js\";\nimport { C } from \"../../../../../chunks/pocketbase.es.js\";\nconst pb = new C(\"https://api.low.sh/\");\nfunction GET({ params, url, request }) {\n  return new Promise((resolve, reject) => {\n    pb.collection(\"comments\").getList(1, 100, {\n      filter: `site = \"${params.site}\" && page = \"${params.page}\"`\n    }).then((data) => {\n      let comments = data.items.map((e) => {\n        return { contents: e.contents, created: timestamp(e.created), id: e.id };\n      });\n      resolve(new Response(JSON.stringify(comments)));\n    });\n  }).catch(() => {\n    throw error(404, \"Not found\");\n  });\n}\nfunction timestamp(ts) {\n  const today = new Date(ts);\n  const yyyy = today.getFullYear();\n  let mm = today.getMonth() + 1;\n  let dd = today.getDate();\n  if (dd < 10)\n    dd = \"0\" + dd;\n  if (mm < 10)\n    mm = \"0\" + mm;\n  return mm + \"/\" + dd + \"/\" + yyyy;\n}\nfunction POST({ params, request }) {\n  console.log(\"posts\");\n  return new Promise(async (resolve, reject) => {\n    let req = await request.json();\n    console.log(req);\n    const data = {\n      \"site\": params.site,\n      \"page\": params.page,\n      \"contents\": req.contents\n    };\n    pb.collection(\"comments\").create(data).then(() => {\n      pb.collection(\"comments\").getList(1, 100, {\n        filter: `site = \"${params.site}\" && page = \"${params.page}\"`\n      }).then((data2) => {\n        let comments = data2.items.map((e) => {\n          return { contents: e.contents, created: timestamp(e.created), id: e.id };\n        });\n        resolve(new Response(JSON.stringify(comments)));\n      });\n    });\n  });\n}\nexport {\n  GET,\n  POST\n};\n"],"names":[],"mappings":"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"}